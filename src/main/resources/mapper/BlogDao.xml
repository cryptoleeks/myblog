<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.loveyx815.blog.dao.BlogDao">
  <resultMap id="BaseResultMap" type="cn.loveyx815.blog.entity.Blog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="c_title" jdbcType="VARCHAR" property="cTitle" />
    <result column="c_content" jdbcType="VARCHAR" property="cContent" />
    <result column="c_uid" jdbcType="VARCHAR" property="cUid" />
    <result column="c_time" jdbcType="DATE" property="cTime" />
    <result column="c_firstid" jdbcType="VARCHAR" property="cFirstId" />
    <result column="c_secondid" jdbcType="VARCHAR" property="cSecondId" />
    <result column="c_lable_id" jdbcType="VARCHAR" property="cLableId" />
    <result column="c_pic_adr" jdbcType="VARCHAR" property="cPicAdr" />
    <result column="c_md" jdbcType="VARCHAR" property="cMd" />
    <result column="c_value" jdbcType="INTEGER" property="cValue" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    id, c_title, c_content, c_uid, c_time,c_firstid,c_secondid, c_lable_id, c_pic_adr, c_value
  </sql>
  <select id="getAllSerach" resultType="java.util.Map">
    select
    u.c_name,u.c_img_adr,b.id, b.c_title, b.c_content, b.c_uid, b.c_time,b.c_firstid,b.c_secondid, b.c_lable_id, b.c_pic_adr, b.c_value,count(c.c_ref_blog) comment,
    code1.c_name fname,code2.c_name sname
    from myblog.t_blog b
    LEFT JOIN myblog.t_comment c on c.c_ref_blog=b.id
    LEFT JOIN myblog.t_user u ON u.id=b.c_uid
    LEFT JOIN myblog.t_code code1 on code1.c_id=b.c_firstid
    LEFT JOIN myblog.t_code code2 ON code2.c_id=b.c_secondid
    <where>

      <if test="serach!=null and serach!=''">
         b.c_title like CONCAT("%",#{serach},"%")
        or b.c_content like CONCAT("%",#{serach},"%")
      </if>
    </where>
    GROUP BY c.c_ref_blog
    order by b.c_time

  </select>
  <select id="getCountBySerach" resultType="java.lang.Integer">
    select count(b.id) from myblog.t_blog b
    <where>
      <if test="serach!=null  and serach!=''">
        b.c_title like CONCAT("%",#{serach},"%")
        or b.c_content like CONCAT("%",#{serach},"%")
      </if>
    </where>
  </select>
  <select id="getBlogCount" resultType="java.lang.Integer">
    select count(b.id) from myblog.t_blog b;
  </select>
  <select id="getBlogByUser" resultMap="BaseResultMap" parameterType="java.lang.String">
    select <include refid="Base_Column_List">

  </include>
  from myblog.t_blog b
  <where>
    <if test="id!=null">
      b.c_uid=#{id}
    </if>
  </where>


  </select>
  <select id="getCategoryName" resultType="java.lang.String">
      SELECT
	case
    when t.c_firstid=#{tabid} then fname
    when t.c_secondid=#{tabid} then sname
    when t.c_lable_id=#{tabid} then lname

end  name
from
	( select
    b.id,b.c_firstid,b.c_secondid, b.c_lable_id,
    code1.c_name fname,code2.c_name sname,l.l_name lname
    from myblog.t_blog b
    LEFT JOIN myblog.t_comment c on c.c_ref_blog=b.id
    LEFT JOIN myblog.t_user u ON u.id=b.c_uid
    LEFT JOIN myblog.t_code code1 on code1.c_id=b.c_firstid
    LEFT JOIN myblog.t_code code2 ON code2.c_id=b.c_secondid
    left join myblog.t_lable l on l.id=b.c_lable_id
    <where>
      b.c_firstid=#{tabid}
      or b.c_secondid=#{tabid}
      or b.c_lable_id=#{tabid}
    </where>) t
			limit 0,1
  </select>
  <select id="getCategoryContentByPage" resultType="java.util.Map">
    select
    u.c_name,u.c_img_adr,b.id, b.c_title, b.c_content, b.c_uid, b.c_time,b.c_firstid,b.c_secondid, b.c_lable_id, b.c_pic_adr, b.c_value,count(c.c_ref_blog) comment,
    code1.c_name fname,code2.c_name sname
    from myblog.t_blog b
    LEFT JOIN myblog.t_user u ON u.id=b.c_uid
    LEFT JOIN myblog.t_comment c on c.c_ref_blog=b.id
    LEFT JOIN myblog.t_code code1 on code1.c_id=b.c_firstid
    LEFT JOIN myblog.t_code code2 ON code2.c_id=b.c_secondid
    left join myblog.t_lable l on l.id=b.c_lable_id
    <where>
      b.c_firstid=#{tabid}
      or b.c_secondid=#{tabid}
      or b.c_lable_id=#{tabid}
    </where>
    GROUP BY b.id
    order by b.c_time
    limit #{cur},#{curSize}
  </select>
<select id="getBlogByCategory" resultType="java.util.Map">
  select
  u.c_name,u.c_img_adr,b.id, b.c_title, b.c_content, b.c_uid, b.c_time,b.c_firstid,b.c_secondid, b.c_lable_id, b.c_pic_adr, b.c_value,count(c.c_ref_blog) comment
  from myblog.t_blog b
  LEFT JOIN myblog.t_comment c on c.c_ref_blog=b.id
  LEFT JOIN myblog.t_user u ON u.id=b.c_uid
  <where>
    b.c_firstid=#{categoryid}
    or b.c_secondid=#{categoryid}
  </where>
  GROUP BY b.id
  order by b.c_time
  limit #{cur},#{curSize}
</select>



  <!--<select id="getCountById" parameterType="java.lang.String" resultType="java.lang.Integer">-->
  <!--select count(id)-->
  <!--from myblog.t_blog b-->
  <!--<where>-->
  <!--<if test="tabid!=null">-->
  <!--b.c_firstid = #{tabid,jdbcType=VARCHAR}-->
  <!--</if>-->
  <!--</where>-->
  <!--</select>-->

  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    select
    <include refid="Base_Column_List" />
    from myblog.t_blog
    where id = #{id,jdbcType=VARCHAR}
  </select>

  <select id="getCountById1" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(id)
    from myblog.t_blog b
    <where>
      <if test="tabid!=null">
        b.c_firstid = #{tabid,jdbcType=VARCHAR}
        or b.c_secondid = #{tabid,jdbcType=VARCHAR}
        or b.c_lable_id = #{tabid,jdbcType=VARCHAR}
      </if>
    </where>
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    delete from myblog.t_blog
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="cn.loveyx815.blog.entity.Blog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    insert into myblog.t_blog (id, c_title, c_content,
    c_uid, c_time,c_firstid,c_secondid, c_lable_id,
    c_pic_adr, c_value)
    values (#{id,jdbcType=VARCHAR}, #{cTitle,jdbcType=VARCHAR}, #{cContent,jdbcType=VARCHAR},
    #{cUid,jdbcType=VARCHAR}, #{cTime,jdbcType=DATE}, #{cFirstId,jdbcType=VARCHAR},#{cSecondId,jdbcType=VARCHAR},#{cLableId,jdbcType=VARCHAR},
    #{cPicAdr,jdbcType=VARCHAR}, #{cValue,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="cn.loveyx815.blog.entity.Blog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    insert into myblog.t_blog
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="cTitle != null">
        c_title,
      </if>
      <if test="cContent != null">
        c_content,
      </if>
      <if test="cUid != null">
        c_uid,
      </if>
      <if test="cTime != null">
        c_time,
      </if>
      <if test="cFirstId != null">
        c_firstid,
      </if>
      <if test="cSecondId != null">
        c_secondid,
      </if>
      <if test="cLableId != null">
        c_lable_id,
      </if>
      <if test="cPicAdr != null">
        c_pic_adr,
      </if>
      <if test="cMd != null">
        c_md,
      </if>
      <if test="cValue != null">
        c_value,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="cTitle != null">
        #{cTitle,jdbcType=VARCHAR},
      </if>
      <if test="cContent != null">
        #{cContent,jdbcType=VARCHAR},
      </if>
      <if test="cUid != null">
        #{cUid,jdbcType=VARCHAR},
      </if>
      <if test="cTime != null">
        #{cTime,jdbcType=DATE},
      </if>
      <if test="cFirstId != null">
        #{cFirstId,jdbcType=VARCHAR},
      </if>
      <if test="cSecondId != null">
        #{cSecondId,jdbcType=VARCHAR},
      </if>
      <if test="cLableId != null">
        #{cLableId,jdbcType=VARCHAR},
      </if>
      <if test="cPicAdr != null">
        #{cPicAdr,jdbcType=VARCHAR},
      </if>
      <if test="cMd != null">
        #{cMd,jdbcType=VARCHAR},
      </if>
      <if test="cValue != null">
        #{cValue,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateValueById" parameterType="java.lang.String">
    update  myblog.t_blog
    <set>
      c_value=c_value+1
    </set>
    <where>
      id=#{id}
    </where>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="cn.loveyx815.blog.entity.Blog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    update myblog.t_blog
    <set>
      <if test="cTitle != null">
        c_title = #{cTitle,jdbcType=VARCHAR},
      </if>
      <if test="cContent != null">
        c_content = #{cContent,jdbcType=VARCHAR},
      </if>
      <if test="cUid != null">
        c_uid = #{cUid,jdbcType=VARCHAR},
      </if>
      <if test="cTime != null">
        c_time = #{cTime,jdbcType=DATE},
      </if>
      <if test="cLableId != null">
        c_lable_id = #{cLableId,jdbcType=VARCHAR},
      </if>
      <if test="cPicAdr != null">
        c_pic_adr = #{cPicAdr,jdbcType=VARCHAR},
      </if>
      <if test="cValue != null">
        c_value = #{cValue,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.loveyx815.blog.entity.Blog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 16:15:48 GMT+08:00 2019.
    -->
    update myblog.t_blog
    set c_title = #{cTitle,jdbcType=VARCHAR},
    c_content = #{cContent,jdbcType=VARCHAR},
    c_uid = #{cUid,jdbcType=VARCHAR},
    c_time = #{cTime,jdbcType=DATE},
    c_lable_id = #{cLableId,jdbcType=VARCHAR},
    c_pic_adr = #{cPicAdr,jdbcType=VARCHAR},
    c_value = #{cValue,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="getArticleById" parameterType="java.lang.String" resultType="java.util.Map">
  select
   b.id, b.c_title, b.c_content, b.c_md,b.c_uid, b.c_time, b.c_lable_id, b.c_value
    ,u.c_name name
  from myblog.t_blog b
  left join myblog.t_user u on b.c_uid=u.id
  where b.id = #{id,jdbcType=VARCHAR}
  </select>


  <select id="getBlogByKid" resultType="cn.loveyx815.blog.entity.Blog">

  </select>

  <select id="getCategory" resultType="java.util.Map">
    SELECT gt.pid ,gt.pname,t3.c_code_id sid,code2.c_name sname from
(
SELECT t1.c_code_id pid ,code.c_name pname
from myblog.t_onecategory t1
left JOIN myblog.t_twocategory t2
on t1.c_code_id=t2.c_code_pid
LEFT JOIN myblog.t_code code
on
 t1.c_code_id=`code`.c_id

  GROUP BY
t1.c_code_id
ORDER BY t1.c_code_id
) gt
LEFT JOIN myblog.t_twocategory t3
on gt.pid=t3.c_code_pid
LEFT JOIN myblog.t_code code2 on
 t3.c_code_id=`code2`.c_id
  </select>
</mapper>